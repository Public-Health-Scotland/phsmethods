<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with CHI numbers • phsmethods</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with CHI numbers">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phsmethods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/chi-operations.html">Working with CHI numbers</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Public-Health-Scotland/phsmethods/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Working with CHI numbers</h1>
                        <h4 data-toc-skip class="author">James
McMahon</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Public-Health-Scotland/phsmethods/blob/master/vignettes/chi-operations.Rmd" class="external-link"><code>vignettes/chi-operations.Rmd</code></a></small>
      <div class="d-none name"><code>chi-operations.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="checking-and-correcting-chi-numbers">Checking and correcting CHI numbers<a class="anchor" aria-label="anchor" href="#checking-and-correcting-chi-numbers"></a>
</h2>
<p>The first thing you should do when working with CHI numbers of
unknown quality is to check their validity. phsmethods provides a
function to easily do this: <code><a href="../reference/chi_check.html">chi_check()</a></code> - This function
expects a character vector (1 or more), it will then return a value for
each CHI number letting you know if it’s valid, and if it isn’t what the
issue is.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chi_numbers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"0211165794"</span>,</span>
<span>  <span class="st">"9999999999"</span>,</span>
<span>  <span class="st">"402070763"</span>,</span>
<span>  <span class="st">"00402070763"</span>,</span>
<span>  <span class="st">"0101010000"</span>,</span>
<span>  <span class="st">"Missing CHI"</span>,</span>
<span>  <span class="cn">NA</span>,</span>
<span>  <span class="st">""</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Public-Health-Scotland/phsmethods" class="external-link">phsmethods</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/chi_check.html">chi_check</a></span><span class="op">(</span><span class="va">chi_numbers</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Valid CHI"                    "Invalid date"                </span></span>
<span><span class="co">#&gt; [3] "Too few characters"           "Too many characters"         </span></span>
<span><span class="co">#&gt; [5] "Invalid checksum"             "Invalid character(s) present"</span></span>
<span><span class="co">#&gt; [7] "Missing (NA)"                 "Missing (Blank)"</span></span></code></pre></div>
<div class="section level3">
<h3 id="cleaning-up-bad-chi-numbers">Cleaning up bad CHI numbers<a class="anchor" aria-label="anchor" href="#cleaning-up-bad-chi-numbers"></a>
</h3>
<p>Usually, we will have the CHI as a variable in some data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>chi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"0211165794"</span>,</span>
<span>  <span class="st">"9999999999"</span>,</span>
<span>  <span class="st">"402070763"</span>,</span>
<span>  <span class="st">"00402070763"</span>,</span>
<span>  <span class="st">"0101010000"</span>,</span>
<span>  <span class="st">"Missing CHI"</span>,</span>
<span>  <span class="cn">NA</span>,</span>
<span>  <span class="st">""</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>It looks like one of the CHI numbers ‘402070763’ might have just lost
a leading zero, this is a common occurrence if the data has passed
through Excel at some point. We can fix this specific issue with
<code><a href="../reference/chi_pad.html">chi_pad()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>chi <span class="op">=</span> <span class="fu"><a href="../reference/chi_pad.html">chi_pad</a></span><span class="op">(</span><span class="va">chi</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">checked_data</span> <span class="op">&lt;-</span> <span class="va">fixed_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>valid_chi <span class="op">=</span> <span class="fu"><a href="../reference/chi_check.html">chi_check</a></span><span class="op">(</span><span class="va">chi</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">checked_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   chi           valid_chi                   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">"</span>0211165794<span style="color: #949494;">"</span>  Valid CHI                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">"</span>9999999999<span style="color: #949494;">"</span>  Invalid date                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #949494;">"</span>0402070763<span style="color: #949494;">"</span>  Valid CHI                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="color: #949494;">"</span>00402070763<span style="color: #949494;">"</span> Too many characters         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="color: #949494;">"</span>0101010000<span style="color: #949494;">"</span>  Invalid checksum            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="color: #949494;">"</span>Missing CHI<span style="color: #949494;">"</span> Invalid character(s) present</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>  <span style="color: #BB0000;">NA</span>           Missing (NA)                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> <span style="color: #949494;">""</span>            Missing (Blank)</span></span></code></pre></div>
<p>On a larger dataset, it might be useful to get a count of the issues
rather than seeing them per CHI.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span>valid_chi <span class="op">=</span> <span class="fu"><a href="../reference/chi_check.html">chi_check</a></span><span class="op">(</span><span class="va">chi</span><span class="op">)</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span></span>
<span><span class="co">#&gt;   valid_chi                        n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Valid CHI                        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Invalid character(s) present     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Invalid checksum                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Invalid date                     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Missing (Blank)                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Missing (NA)                     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Too many characters              1</span></span></code></pre></div>
<p>Now we have this knowledge we have a few options. Which option we
take will depend on the type and purpose of the analysis as well as how
many CHI numbers have issues.</p>
<ol style="list-style-type: decimal">
<li>Go back to the data source/provider and try to fix the erroneous CHI
numbers.</li>
<li>Set them as NA so we keep the rest of the data.</li>
<li>Filter the data with invalid CHIs out completely.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>chi <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="../reference/chi_check.html">chi_check</a></span><span class="op">(</span><span class="va">chi</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"Valid CHI"</span>, <span class="cn">NA_character_</span>, <span class="va">chi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 1</span></span></span>
<span><span class="co">#&gt;   chi       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0211165794</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> <span style="color: #BB0000;">NA</span></span></span>
<span></span>
<span><span class="va">fixed_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/chi_check.html">chi_check</a></span><span class="op">(</span><span class="va">chi</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Valid CHI"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 1</span></span></span>
<span><span class="co">#&gt;   chi       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0211165794</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0402070763</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="inferring-data-from-a-chi-number">Inferring data from a CHI number<a class="anchor" aria-label="anchor" href="#inferring-data-from-a-chi-number"></a>
</h2>
<p>In an ideal world, we would always have supplementary data such as
Date of Birth, Age and Sex alongside the CHI number, however, we often
work with data where we only have the CHI number and the other
demographic variables are either completely missing or incomplete.</p>
<p>Once we have checked and (if necessary) padded the CHI numbers, we
can then try and extract some information from them.</p>
<div class="section level4">
<h4 id="the-structure-of-a-chi-number">The structure of a CHI number<a class="anchor" aria-label="anchor" href="#the-structure-of-a-chi-number"></a>
</h4>
<p>As explained in this <a href="https://en.wikipedia.org/wiki/National_Health_Service_Central_Register#Community_Health_Index" class="external-link">Wikipedia
article</a> a CHI number is constructed as follows: * The first 6 digits
are the patient’s Date of Birth in the format <code>DDMMYY</code>. *
Digits 7 and 8 are random. * The 9<sup>th</sup> number indicates the
patient’s sex - odd for male, even for female. * The final,
10<sup>th</sup>, digit is a (Modulus-11) ‘check digit’ - This helps
guard against transcription errors, for example, if someone makes a typo
it is very unlikely that the check digit will still be valid.</p>
</div>
<div class="section level3">
<h3 id="extracting-sex-from-chi">Extracting sex from CHI<a class="anchor" aria-label="anchor" href="#extracting-sex-from-chi"></a>
</h3>
<p>With <code><a href="../reference/sex_from_chi.html">sex_from_chi()</a></code> we can extract the infer and extract
the patient’s sex. By default, the function will first check the CHI for
validity and will return <code>NA</code> if a CHI is invalid.</p>
<p>If you have already checked the CHI in a previous step it can be
useful to use <code>chi_check = FALSE</code> as this will be faster.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  chi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0101011237"</span>, <span class="st">"0211165794"</span>, <span class="st">"0402070763"</span>, <span class="st">"0101336489"</span>, <span class="st">"1904851231"</span>, <span class="st">"2902960018"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Confirm all of the CHIs are valid</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="../reference/chi_check.html">chi_check</a></span><span class="op">(</span><span class="va">chi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   `chi_check(chi)`     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Valid CHI            6</span></span>
<span></span>
<span><span class="va">data_sex</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="../reference/sex_from_chi.html">sex_from_chi</a></span><span class="op">(</span><span class="va">chi</span>, chi_check <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_sex</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   chi          sex</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018     1</span></span></code></pre></div>
<p>By default sex will be returned as an integer with ‘1’ representing
‘Male’ and ‘2’ representing ‘Female’, this is consistent with the <a href="https://www.ndc.scot.nhs.uk/Dictionary-A-Z/Definitions/index.asp?Search=S&amp;ID=1277&amp;Title=Sex" class="external-link">coding
of sex</a> in other PHS datasets.</p>
<p>We can have sex returned as a factor using
<code>as_factor = TRUE</code>, which by default will have levels of ‘1’
and ‘2’ and labels of ‘Male’ and ‘Female’ which can be useful,
particularly when visualising the data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_sex</span> <span class="op">&lt;-</span> <span class="va">data_sex</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex_factor <span class="op">=</span> <span class="fu"><a href="../reference/sex_from_chi.html">sex_from_chi</a></span><span class="op">(</span><span class="va">chi</span>, as_factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_sex</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   chi          sex sex_factor</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237     1 Male      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794     1 Male      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763     2 Female    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489     2 Female    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231     1 Male      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018     1 Male</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_sex</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">""</span>, fill <span class="op">=</span> <span class="va">sex_factor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html" class="external-link">coord_polar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Count of Male vs Female"</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span><span class="st">"Sex (from CHI)"</span>, type <span class="op">=</span> <span class="st">"qual"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="chi-operations_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="extracting-date-of-birth-from-chi">Extracting Date of Birth from CHI<a class="anchor" aria-label="anchor" href="#extracting-date-of-birth-from-chi"></a>
</h3>
<p>It is usually not possible to definitively infer a patient’s Date of
Birth from the CHI number, this is because the CHI only contains 2
digits for the year. Looking at the first 6 digits of a CHI number
‘010120’ could be ‘1 January 1920’ or ‘1 January 2020’. However, with
some extra context, we can usually eliminate one of the possibilities,
for example in 2023 we know that any CHI numbers of the form ‘DDMM24’
etc. must mean 1924 since it can’t be 2024.</p>
<p>The function <code><a href="../reference/dob_from_chi.html">dob_from_chi()</a></code> will try to extract the Date
of Birth and will return <code>NA</code> if the date is ambiguous.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dob</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dob <span class="op">=</span> <span class="fu"><a href="../reference/dob_from_chi.html">dob_from_chi</a></span><span class="op">(</span><span class="va">chi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 3 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_date` and/or `max_date`.</span></span>
<span></span>
<span><span class="va">data_dob</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   chi        dob       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 1933-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 1985-04-19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 1996-02-29</span></span></code></pre></div>
<p>We will need to provide some more context to be able to work out the
still missing dates. Often we will be working with historical data, for
instance, if we know the data is from 2015 we know the patients must
have been born earlier than that. We can use the <code>min_date</code>
and <code>max_date</code> arguments to provide this context.</p>
<ul>
<li>
<code>min_date</code> will usually be some information from the
data, it is the latest possible date that the CHI could have been
born.</li>
<li>
<code>max_date</code> will default to today’s date, it will usually
be some common sense date about the latest date you’d expect. For
instance, if working with childhood vaccine data you could use
<code>Sys.Date() - lubridate::years(16)</code>, it to imply you don’t
expect anyone older than 16 as of today’s date.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Expect no one born after 2015-12-31</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dob <span class="op">=</span> <span class="fu"><a href="../reference/dob_from_chi.html">dob_from_chi</a></span><span class="op">(</span><span class="va">chi</span>, max_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2015-12-31"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 2 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_date` and/or `max_date`.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   chi        dob       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 1916-11-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 1933-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 1985-04-19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 1996-02-29</span></span>
<span></span>
<span><span class="co"># Expect no one born before 1999-12-31 i.e. 16 years before our data started.</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dob <span class="op">=</span> <span class="fu"><a href="../reference/dob_from_chi.html">dob_from_chi</a></span><span class="op">(</span></span>
<span>    <span class="va">chi</span>,</span>
<span>    max_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2015-12-31"</span><span class="op">)</span>,</span>
<span>    min_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2015-12-31"</span><span class="op">)</span> <span class="op">-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">years</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 4 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_date` and/or `max_date`.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   chi        dob       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 2001-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 2007-02-04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Usually, we will have event dates e.g. an admission date alongside
the data and this can be used instead of, or in conjunction with a fixed
date.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>event_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"2015-01-01"</span>,</span>
<span>    <span class="st">"2014-01-01"</span>,</span>
<span>    <span class="st">"2013-01-01"</span>,</span>
<span>    <span class="st">"2012-01-01"</span>,</span>
<span>    <span class="st">"2011-01-01"</span>,</span>
<span>    <span class="st">"2010-01-01"</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using the event date as the maximum date</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dob <span class="op">=</span> <span class="fu"><a href="../reference/dob_from_chi.html">dob_from_chi</a></span><span class="op">(</span><span class="va">chi</span>, max_date <span class="op">=</span> <span class="va">event_date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 2 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_date` and/or `max_date`.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   chi        event_date dob       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 2015-01-01 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 2014-01-01 1916-11-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 2013-01-01 <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 2012-01-01 1933-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 2011-01-01 1985-04-19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 2010-01-01 1996-02-29</span></span>
<span></span>
<span><span class="co"># Setting a 'fixed' minimum date as well as using the event date</span></span>
<span><span class="va">data_dob</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dob <span class="op">=</span> <span class="fu"><a href="../reference/dob_from_chi.html">dob_from_chi</a></span><span class="op">(</span></span>
<span>    <span class="va">chi</span>,</span>
<span>    max_date <span class="op">=</span> <span class="va">event_date</span>,</span>
<span>    min_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1915-01-01"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_dob</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   chi        event_date dob       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 2015-01-01 2001-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 2014-01-01 1916-11-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 2013-01-01 2007-02-04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 2012-01-01 1933-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 2011-01-01 1985-04-19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 2010-01-01 1996-02-29</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-age-from-chi">Extracting age from CHI<a class="anchor" aria-label="anchor" href="#extracting-age-from-chi"></a>
</h3>
<p>The function <code><a href="../reference/age_from_chi.html">age_from_chi()</a></code> provides a simpler interface
for just extracting a patient’s age from the CHI number. In the
background, it uses <code><a href="../reference/dob_from_chi.html">dob_from_chi()</a></code> but allows you to
specify <code>min_age</code> and <code>max_age</code>, which are usually
conceptually simpler than trying to work out dates. We do lose some
amount of fine control here though, so it will sometimes be necessary to
use <code><a href="../reference/dob_from_chi.html">dob_from_chi()</a></code> and then
<code><a href="../reference/age_calculate.html">age_calculate()</a></code>.</p>
<p>Note that age is calculated at <em>today’s</em> date unless otherwise
specified with the <code>ref_date</code> argument.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="../reference/age_from_chi.html">age_from_chi</a></span><span class="op">(</span><span class="va">chi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 3 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_age` and/or `max_age`.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   chi        event_date   age</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 2015-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 2014-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 2013-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 2012-01-01    92</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 2011-01-01    40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 2010-01-01    29</span></span>
<span></span>
<span><span class="co"># Work out age at a fixed date</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="../reference/age_from_chi.html">age_from_chi</a></span><span class="op">(</span><span class="va">chi</span>, ref_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2016-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 2 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_age` and/or `max_age`.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   chi        event_date   age</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 2015-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 2014-01-01    99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 2013-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 2012-01-01    83</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 2011-01-01    30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 2010-01-01    19</span></span>
<span></span>
<span><span class="co"># Work out age at a relative date</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="../reference/age_from_chi.html">age_from_chi</a></span><span class="op">(</span><span class="va">chi</span>, ref_date <span class="op">=</span> <span class="va">event_date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 2 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_age` and/or `max_age`.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   chi        event_date   age</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 2015-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 2014-01-01    97</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 2013-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 2012-01-01    79</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 2011-01-01    25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 2010-01-01    13</span></span></code></pre></div>
<p>We will get different results depending on which context we
supply.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="../reference/age_from_chi.html">age_from_chi</a></span><span class="op">(</span><span class="va">chi</span>, ref_date <span class="op">=</span> <span class="va">event_date</span>, max_age <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 3 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_age` and/or `max_age`.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   chi        event_date   age</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 2015-01-01    14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 2014-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 2013-01-01     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 2012-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 2011-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 2010-01-01    13</span></span>
<span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="../reference/age_from_chi.html">age_from_chi</a></span><span class="op">(</span></span>
<span>    <span class="va">chi</span>,</span>
<span>    ref_date <span class="op">=</span> <span class="va">event_date</span>,</span>
<span>    min_age <span class="op">=</span> <span class="fl">60</span>,</span>
<span>    max_age <span class="op">=</span> <span class="fl">120</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 2 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_age` and/or `max_age`.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   chi        event_date   age</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 2015-01-01   114</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 2014-01-01    97</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 2013-01-01   105</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 2012-01-01    79</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 2011-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 2010-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="../reference/age_from_chi.html">age_from_chi</a></span><span class="op">(</span></span>
<span>    <span class="va">chi</span>,</span>
<span>    min_age <span class="op">=</span> <span class="fl">60</span>,</span>
<span>    max_age <span class="op">=</span> <span class="fl">120</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 3 CHI numbers produced ambiguous dates and will be given <span style="color: #0000BB;">"NA"</span> for their Dates</span></span>
<span><span class="co">#&gt;   of Birth.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Try different values for `min_age` and/or `max_age`.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   chi        event_date   age</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0101011237 2015-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0211165794 2014-01-01   108</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0402070763 2013-01-01   118</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0101336489 2012-01-01    92</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1904851231 2011-01-01    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2902960018 2010-01-01    <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Caldwell, Jack Hannah, Tina Fu, Ciara Gribben, Chris Deans, Jaime Villacampa, Graeme Gowans, James McMahon, Nicolaos Christofidis.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
