<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using percent vectors • phsmethods</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using percent vectors">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phsmethods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/chi-operations.html">Working with CHI numbers</a></li>
    <li><a class="dropdown-item" href="../articles/percent.html">Using percent vectors</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Public-Health-Scotland/phsmethods/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="percent_files/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="percent_files/tabwid-1.1.3/tabwid.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using percent vectors</h1>
                        <h4 data-toc-skip class="author">Nick
Christofides</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Public-Health-Scotland/phsmethods/blob/master/vignettes/percent.Rmd" class="external-link"><code>vignettes/percent.Rmd</code></a></small>
      <div class="d-none name"><code>percent.Rmd</code></div>
    </div>

    
    
<p>Let’s start by loading the phsmethods package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Public-Health-Scotland/phsmethods" class="external-link">phsmethods</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>Working with percentages in R can be frustrating, to say the least. A
typical workflow for generating percentages might look like this:</p>
<ul>
<li>Generate proportions</li>
<li>Scale up proportions to percentages (multiplying by 100)</li>
<li>Round percentages</li>
<li>Convert percentages to characters</li>
<li>Append a percentage symbol</li>
<li>Use proportions for math operations and rounding</li>
<li>Use formatted percentage strings for outputs</li>
</ul>
<p>With <code>&lt;percent&gt;</code> vectors, this workflow is reduced
to:</p>
<ul>
<li>Generate proportions</li>
<li>Convert to percentages</li>
</ul>
<p>This is clearly much simpler and allows for cleaner and more
reproducible code.</p>
</div>
<div class="section level2">
<h2 id="creating-percentages">Creating percentages<a class="anchor" aria-label="anchor" href="#creating-percentages"></a>
</h2>
<p>The primary function for converting to percentages is
<code><a href="../reference/percent.html">as_percent()</a></code>. This converts a <code>&lt;numeric&gt;</code>
vector to a <code>&lt;percent&gt;</code> vector, handling the formatting
and rounding when needed, i.e printing or converting to a character
vector.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/percent.html">as_percent</a></span><span class="op">(</span><span class="fl">0.055</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "5.5%"</span></span></code></pre></div>
<p>Internally, the numeric vector is left as-is, which can be confirmed
by examining the vector via <code>unclass(x)</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.055</span></span>
<span><span class="co">#&gt; attr(,".digits")</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>The only time percentage formatting actually happens is when the
<code>&lt;percent&gt;</code> vector is printed or converted to a
character vector (via <code>as.character</code> or
<code>format</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "5.5%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "5.5%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "5.5%"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rounding">Rounding<a class="anchor" aria-label="anchor" href="#rounding"></a>
</h2>
<p>Percentages are rounded using a round-halves-up approach. The
rationale for straying away from R’s round-to-even is that readers
generally expect percentages to be rounded this way in formatted outputs
such as papers, reports, etc. We are less concerned with statistical
bias and more concerned with formatting.</p>
<p>There are two main ways to control how percent vectors are
rounded:</p>
</div>
<div class="section level2">
<h2 id="rounding-via-as_percent-digits">Rounding via <code>as_percent</code> + <code>digits</code><a class="anchor" aria-label="anchor" href="#rounding-via-as_percent-digits"></a>
</h2>
<p><code>as_percent</code> does two things:</p>
<ol style="list-style-type: decimal">
<li>It creates a <code>&lt;percent&gt;</code> vector</li>
<li>It sets the “.digits” attribute, which controls how the percent
vector is printed downstream.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/percent.html">as_percent</a></span><span class="op">(</span><span class="va">p</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prints and formats to 0 decimal places</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "6%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "6%"</span></span>
<span></span>
<span><span class="co"># Underlying data has not been rounded!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.055</span></span>
<span><span class="co">#&gt; attr(,".digits")</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rounding-via-round">Rounding via <code>round()</code><a class="anchor" aria-label="anchor" href="#rounding-via-round"></a>
</h2>
<p>This method will ‘physically’ round the numbers.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">p</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span></span>
<span><span class="co">#&gt; [1] "6%"</span></span>
<span></span>
<span><span class="co"># Underlying data has been rounded</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.06</span></span>
<span><span class="co">#&gt; attr(,".digits")</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>In practice, this means that rounding with <code>as_percent</code> is
more flexible as it reduces downstream errors that can accumulate from
premature rounding.</p>
</div>
<div class="section level2">
<h2 id="math-with-percent-vectors">Math with percent vectors<a class="anchor" aria-label="anchor" href="#math-with-percent-vectors"></a>
</h2>
<p>A strong feature of <code>&lt;percent&gt;</code> vectors is the
ability to use them in mathematical contexts without extra unnecessary
work.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Helper to create literal percentages</span></span>
<span><span class="va">percent</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/percent.html">as_percent</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Addition, subtraction, multiplication and division.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">percent</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="op">+</span> <span class="fu">percent</span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="co"># = 50% + 25% = 75%</span></span>
<span><span class="co">#&gt; [1] "75%"</span></span>
<span><span class="fu">percent</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="op">-</span> <span class="fu">percent</span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="co"># = 50% - 25% = 25%</span></span>
<span><span class="co">#&gt; [1] "25%"</span></span>
<span><span class="fu">percent</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="op">*</span> <span class="fu">percent</span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="co"># = 50% * (1/4) = 12.5%</span></span>
<span><span class="co">#&gt; [1] "12.5%"</span></span>
<span><span class="fu">percent</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="op">/</span> <span class="fu">percent</span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="co"># = 50% / (1/4) = 200%</span></span>
<span><span class="co">#&gt; [1] "200%"</span></span></code></pre></div>
<p>More rounding functions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percentages</span> <span class="op">&lt;-</span> <span class="fu">percent</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">percentages</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-1%" "-1%" "0%"  "0%"  "0%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">percentages</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "0%" "0%" "0%" "1%" "1%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">trunc</a></span><span class="op">(</span><span class="va">percentages</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "0%" "0%" "0%" "0%" "0%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">percentages</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "0%" "0%" "0%" "0%" "0%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">percentages</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-0.1%" "-0.1%" "0.0%"  "0.1%"  "0.1%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">percentages</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-0.10%" "-0.05%" "0.00%"  "0.05%"  "0.10%"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="percent-vectors-and-tidyverse">percent vectors and tidyverse<a class="anchor" aria-label="anchor" href="#percent-vectors-and-tidyverse"></a>
</h2>
<p><code>&lt;percent&gt;</code> vectors can be used in tibbles just like
regular vectors.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="va">starwars</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">species</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>perc <span class="op">=</span> <span class="fu"><a href="../reference/percent.html">as_percent</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prints nicely</span></span>
<span><span class="va">species</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 3</span></span></span>
<span><span class="co">#&gt;   species      n perc     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;percent&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Human       35 40.2%    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Droid        6 6.9%     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>           4 4.6%     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Gungan       3 3.4%     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Kaminoan     2 2.3%</span></span></code></pre></div>
<p>We can also do statistical summaries.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perc_summary</span> <span class="op">&lt;-</span> <span class="va">species</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">perc</span><span class="op">)</span>,</span>
<span>    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">perc</span><span class="op">)</span>,</span>
<span>    median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">perc</span><span class="op">)</span>,</span>
<span>    avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">perc</span><span class="op">)</span>,</span>
<span>    sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">perc</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">perc_summary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   min       max       median    avg       sum      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;percent&gt;</span> <span style="color: #949494; font-style: italic;">&lt;percent&gt;</span> <span style="color: #949494; font-style: italic;">&lt;percent&gt;</span> <span style="color: #949494; font-style: italic;">&lt;percent&gt;</span> <span style="color: #949494; font-style: italic;">&lt;percent&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1.1%      40.2%     1.1%      2.6%      100%</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="percent-vectors-and-formatted-tables">
<code>&lt;percent&gt;</code> vectors and formatted tables<a class="anchor" aria-label="anchor" href="#percent-vectors-and-formatted-tables"></a>
</h2>
<p>They can also be easily and nicely formatted into tables (e.g. via
<code><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable()</a></code>)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">perc_summary</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">min</th>
<th align="right">max</th>
<th align="right">median</th>
<th align="right">avg</th>
<th align="right">sum</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">1.1%</td>
<td align="right">40.2%</td>
<td align="right">1.1%</td>
<td align="right">2.6%</td>
<td align="right">100%</td>
</tr></tbody>
</table>
<p>And flextables.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/" class="external-link">flextable</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html" class="external-link">qflextable</a></span><span class="op">(</span><span class="va">perc_summary</span><span class="op">)</span></span></code></pre></div>
<div class="tabwid">
<style>.cl-4f105494{}.cl-4f031590{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-4f06c154{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-4f06edd2{width:0.633in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4f06eddc{width:0.718in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4f06eddd{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4f06ede6{width:0.676in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4f06ede7{width:0.633in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4f06ede8{width:0.718in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4f06edf0{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4f06edf1{width:0.676in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="table cl-4f105494">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-4f06edd2"><p class="cl-4f06c154"><span class="cl-4f031590">min</span></p></th>
<th class="cl-4f06eddc"><p class="cl-4f06c154"><span class="cl-4f031590">max</span></p></th>
<th class="cl-4f06eddd"><p class="cl-4f06c154"><span class="cl-4f031590">median</span></p></th>
<th class="cl-4f06edd2"><p class="cl-4f06c154"><span class="cl-4f031590">avg</span></p></th>
<th class="cl-4f06ede6"><p class="cl-4f06c154"><span class="cl-4f031590">sum</span></p></th>
</tr></thead>
<tbody><tr style="overflow-wrap:break-word;">
<td class="cl-4f06ede7"><p class="cl-4f06c154"><span class="cl-4f031590">1.1%</span></p></td>
<td class="cl-4f06ede8"><p class="cl-4f06c154"><span class="cl-4f031590">40.2%</span></p></td>
<td class="cl-4f06edf0"><p class="cl-4f06c154"><span class="cl-4f031590">1.1%</span></p></td>
<td class="cl-4f06ede7"><p class="cl-4f06c154"><span class="cl-4f031590">2.6%</span></p></td>
<td class="cl-4f06edf1"><p class="cl-4f06c154"><span class="cl-4f031590">100%</span></p></td>
</tr></tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="percent-vectors-and-ggplot2">percent vectors and <code>ggplot2</code><a class="anchor" aria-label="anchor" href="#percent-vectors-and-ggplot2"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_data</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    prop <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    perc <span class="op">=</span> <span class="fu"><a href="../reference/percent.html">as_percent</a></span><span class="op">(</span></span>
<span>      <span class="va">prop</span>,</span>
<span>      digits <span class="op">=</span> <span class="fl">1</span> <span class="co"># To control formatting in ggplot + elsewhere</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">gg_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;   Species        n  prop perc     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;percent&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> setosa        50 0.333 33.3%    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> versicolor    50 0.333 33.3%    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> virginica     50 0.333 33.3%</span></span>
<span></span>
<span><span class="va">species_gg</span> <span class="op">&lt;-</span> <span class="va">gg_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">prop</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span></code></pre></div>
<p>Use <code>as_percent</code> for formatting percentage axes.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species_gg</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Percentage"</span>, labels <span class="op">=</span> <span class="va">as_percent</span><span class="op">)</span></span></code></pre></div>
<p><img src="percent_files/figure-html/unnamed-chunk-15-1.png" class="r-plt" alt="" width="672"></p>
<p>We can also use <code>&lt;percent&gt;</code> vectors as ggplot
aesthetics<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Using &lt;code&gt;&amp;lt;percent&amp;gt;&lt;/code&gt; vectors in ggplot2 is
currently limited and you are likely to face issues with using them as
plot aesthetics. This can include messages surrounding unsupported
scales and axes. With the new release of ggplot2 4.0.0, there is
potential for embedding &lt;code&gt;&amp;lt;percent&amp;gt;&lt;/code&gt; vectors more
formally and programmatically into &lt;code&gt;ggplot2&lt;/code&gt;. This is
currently being worked on.&lt;/p&gt;"><sup>1</sup></a></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="va">perc</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_radial.html" class="external-link">coord_polar</a></span><span class="op">(</span><span class="st">"y"</span>, start <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">perc</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_stack.html" class="external-link">position_stack</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Don't know how to automatically pick scale for object of type <span style="color: #0000BB;">&lt;percent&gt;</span>.</span></span>
<span><span class="co">#&gt; Defaulting to continuous.</span></span>
<span><span class="co">#&gt; Don't know how to automatically pick scale for object of type <span style="color: #0000BB;">&lt;percent&gt;</span>.</span></span>
<span><span class="co">#&gt; Defaulting to continuous.</span></span></code></pre></div>
<p><img src="percent_files/figure-html/unnamed-chunk-16-1.png" class="r-plt" alt="" width="672"></p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Caldwell, Jack Hannah, Tina Fu, Ciara Gribben, Chris Deans, Jaime Villacampa, Graeme Gowans, James Hayes, Nicolaos Christofidis.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
